# SQLBot Docker è¿è¡ŒæŒ‡å—

## ğŸ‰ é•œåƒå·²æ„å»ºæˆåŠŸ

é•œåƒåç§°: `registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1`

---

## ğŸš€ æ–¹å¼ 1ï¼šä½¿ç”¨ Docker Compose å¯åŠ¨ï¼ˆæ¨èï¼‰

### 1. å¯åŠ¨å®¹å™¨

```bash
docker-compose up -d
```

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100
```

### 3. åœæ­¢å®¹å™¨

```bash
docker-compose down
```

### 4. é‡å¯å®¹å™¨

```bash
docker-compose restart
```

---

## ğŸ³ æ–¹å¼ 2ï¼šä½¿ç”¨ Docker å‘½ä»¤ç›´æ¥è¿è¡Œ

```bash
docker run -d \
  --name sqlbot \
  --restart always \
  -p 8000:8000 \
  -p 5432:5432 \
  -e POSTGRES_SERVER=localhost \
  -e POSTGRES_PORT=5432 \
  -e POSTGRES_DB=sqlbot \
  -e POSTGRES_USER=root \
  -e POSTGRES_PASSWORD=Password123@pg \
  -e PROJECT_NAME="SQLBot" \
  -e DEFAULT_PWD="SQLBot@123456" \
  -e LOG_LEVEL="INFO" \
  -v ./data/sqlbot/excel:/opt/sqlbot/data/excel \
  -v ./data/sqlbot/file:/opt/sqlbot/data/file \
  -v ./data/sqlbot/logs:/opt/sqlbot/app/logs \
  -v ./data/postgresql:/var/lib/postgresql/data \
  registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1
```

---

## ğŸ“‹ å¯åŠ¨åæ£€æŸ¥

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
docker ps | findstr sqlbot
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
CONTAINER ID   IMAGE                                                    STATUS
xxxxxxxx       registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1   Up 2 minutes
```

### 2. æ£€æŸ¥å¥åº·çŠ¶æ€

```bash
docker inspect sqlbot | findstr Health -A 5
```

### 3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
docker logs sqlbot
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://localhost:8000
- **API æ–‡æ¡£**: http://localhost:8000/api/v1/docs

### 5. é»˜è®¤ç™»å½•ä¿¡æ¯

æ ¹æ®é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤å¯†ç åº”è¯¥æ˜¯ï¼š

- **å¯†ç **: `SQLBot@123456`

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### è¿›å…¥å®¹å™¨

```bash
docker exec -it sqlbot bash
```

### æŸ¥çœ‹æ¨¡å‹æ–‡ä»¶

```bash
docker exec -it sqlbot ls -lh /opt/sqlbot/models/text2vec-base-chinese/
```

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
# ä¸»æœºä¸ŠæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
Get-Content data/sqlbot/logs/debug.log -Tail 50 -Wait
```

### é‡å¯å®¹å™¨

```bash
docker restart sqlbot
```

### åœæ­¢å®¹å™¨

```bash
docker stop sqlbot
```

### åˆ é™¤å®¹å™¨

```bash
docker rm -f sqlbot
```

---

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

æ•°æ®ä¼šä¿å­˜åœ¨ä¸»æœºçš„ä»¥ä¸‹ç›®å½•ï¼š

```
data/
â”œâ”€â”€ sqlbot/
â”‚   â”œâ”€â”€ excel/           # Excel æ–‡ä»¶
â”‚   â”œâ”€â”€ file/            # ä¸Šä¼ çš„æ–‡ä»¶
â”‚   â””â”€â”€ logs/            # åº”ç”¨æ—¥å¿—
â””â”€â”€ postgresql/          # PostgreSQL æ•°æ®åº“æ–‡ä»¶
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å®¹å™¨å¯åŠ¨å¤±è´¥

**æ£€æŸ¥æ—¥å¿—**:

```bash
docker logs sqlbot
```

**å¸¸è§åŸå› **:

- ç«¯å£è¢«å ç”¨ï¼ˆ8000 æˆ– 5432ï¼‰
- æ•°æ®ç›®å½•æƒé™é—®é¢˜
- ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯

### é—®é¢˜ 2: æ— æ³•è®¿é—®åº”ç”¨

**æ£€æŸ¥ç«¯å£**:

```bash
netstat -ano | findstr :8000
```

**æ£€æŸ¥å®¹å™¨ç½‘ç»œ**:

```bash
docker inspect sqlbot | findstr IPAddress
```

### é—®é¢˜ 3: æ¨¡å‹åŠ è½½å¤±è´¥

**éªŒè¯æ¨¡å‹æ–‡ä»¶**:

```bash
docker exec -it sqlbot ls -la /opt/sqlbot/models/text2vec-base-chinese/
```

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å…³é”®æ–‡ä»¶ï¼š

- config.json
- model.safetensors
- tokenizer_config.json
- vocab.txt

### é—®é¢˜ 4: æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥ PostgreSQL**:

```bash
docker exec -it sqlbot psql -U root -d sqlbot -c "\dt"
```

---

## ğŸ”„ æ›´æ–°é•œåƒ

### 1. åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨

```bash
docker-compose down
```

### 2. é‡æ–°æ„å»ºé•œåƒ

```bash
docker build -t registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1 .
```

### 3. å¯åŠ¨æ–°å®¹å™¨

```bash
docker-compose up -d
```

---

## ğŸ“¦ æ¨é€é•œåƒåˆ°ä»“åº“ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åˆ†äº«é•œåƒæˆ–éƒ¨ç½²åˆ°å…¶ä»–æœåŠ¡å™¨ï¼š

```bash
# ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
docker login --username=ä½ çš„ç”¨æˆ·å registry.cn-qingdao.aliyuncs.com

# æ¨é€é•œåƒ
docker push registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1
```

åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šæ‹‰å–ï¼š

```bash
docker pull registry.cn-qingdao.aliyuncs.com/images-lsr/sqlbot:dev-rc1
```

---

## ğŸ“ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

å¯ä»¥åœ¨ `docker-compose.yaml` ä¸­ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

| å˜é‡              | è¯´æ˜       | é»˜è®¤å€¼         |
| ----------------- | ---------- | -------------- |
| POSTGRES_DB       | æ•°æ®åº“åç§° | sqlbot         |
| POSTGRES_USER     | æ•°æ®åº“ç”¨æˆ· | root           |
| POSTGRES_PASSWORD | æ•°æ®åº“å¯†ç  | Password123@pg |
| PROJECT_NAME      | é¡¹ç›®åç§°   | SQLBot         |
| DEFAULT_PWD       | é»˜è®¤å¯†ç    | SQLBot@123456  |
| LOG_LEVEL         | æ—¥å¿—çº§åˆ«   | INFO           |
| SECRET_KEY        | JWT å¯†é’¥   | (è‡ªåŠ¨ç”Ÿæˆ)     |

### ç«¯å£æ˜ å°„

| å®¹å™¨ç«¯å£ | ä¸»æœºç«¯å£ | è¯´æ˜                  |
| -------- | -------- | --------------------- |
| 8000     | 8000     | Web åº”ç”¨ç«¯å£          |
| 5432     | 5432     | PostgreSQL æ•°æ®åº“ç«¯å£ |

å¦‚éœ€ä¿®æ”¹ä¸»æœºç«¯å£ï¼Œç¼–è¾‘ `docker-compose.yaml`:

```yaml
ports:
  - "ä½ çš„ç«¯å£:8000"
  - "ä½ çš„ç«¯å£:5432"
```

---

## âœ… éªŒè¯æ¸…å•

å¯åŠ¨åï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] å®¹å™¨çŠ¶æ€ä¸º `Up`
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å¯ä»¥è®¿é—® http://localhost:8000
- [ ] æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯
- [ ] æ¨¡å‹æ–‡ä»¶å­˜åœ¨
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸

å…¨éƒ¨é€šè¿‡åˆ™è¯´æ˜éƒ¨ç½²æˆåŠŸï¼ğŸ‰
